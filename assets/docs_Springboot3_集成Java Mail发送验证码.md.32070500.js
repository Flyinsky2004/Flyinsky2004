import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.dc2d320f.js";const d=JSON.parse('{"title":"集成Java Mail发送验证码","description":"","frontmatter":{"date":"2023-11-16T15:08:00.000Z","author":"Flyinsky","tags":["java","Springboot"],"categories":["java"]},"headers":[],"relativePath":"docs/Springboot3/集成Java Mail发送验证码.md","filePath":"docs/Springboot3/集成Java Mail发送验证码.md","lastUpdated":null}'),p={name:"docs/Springboot3/集成Java Mail发送验证码.md"},o=l(`<h1 id="集成java-mail发送验证码" tabindex="-1">集成Java Mail发送验证码 <a class="header-anchor" href="#集成java-mail发送验证码" aria-label="Permalink to &quot;集成Java Mail发送验证码&quot;">​</a></h1><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>开发web app时经常会遇到给用户发送验证码或是小广告的应用场景，今天记录一下如何在Springboot中集成Java Mail(以Outlook示例)</p></div><h2 id="_1-添加依赖" tabindex="-1">1.添加依赖 <a class="header-anchor" href="#_1-添加依赖" aria-label="Permalink to &quot;1.添加依赖&quot;">​</a></h2><p>在pom.xml中的dependencies标签中添加以下子标签：</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-darker vp-code-dark"><code><span class="line"><span style="color:#EEFFFF;">		</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">dependency</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">            </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">groupId</span><span style="color:#89DDFF;">&gt;</span><span style="color:#EEFFFF;">org.springframework.boot</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">groupId</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">            </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">artifactId</span><span style="color:#89DDFF;">&gt;</span><span style="color:#EEFFFF;">spring-boot-starter-mail</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">artifactId</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">dependency</span><span style="color:#89DDFF;">&gt;</span></span></code></pre><pre class="shiki light-plus vp-code-light"><code><span class="line"><span style="color:#000000;">		</span><span style="color:#800000;">&lt;dependency&gt;</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#800000;">&lt;groupId&gt;</span><span style="color:#000000;">org.springframework.boot</span><span style="color:#800000;">&lt;/groupId&gt;</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#800000;">&lt;artifactId&gt;</span><span style="color:#000000;">spring-boot-starter-mail</span><span style="color:#800000;">&lt;/artifactId&gt;</span></span>
<span class="line"><span style="color:#000000;">        </span><span style="color:#800000;">&lt;/dependency&gt;</span></span></code></pre></div><h2 id="_2-配置文件" tabindex="-1">2.配置文件 <a class="header-anchor" href="#_2-配置文件" aria-label="Permalink to &quot;2.配置文件&quot;">​</a></h2><p>添加依赖信息后刷新maven，在application.yml中填写属性。</p><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki material-theme-darker vp-code-dark"><code><span class="line"><span style="color:#F07178;">mail</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#545454;font-style:italic;"># 配置 SMTP 服务器地址</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#F07178;">host</span><span style="color:#89DDFF;">:</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">smtp.office365.com</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#545454;font-style:italic;"># 发送者邮箱</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#F07178;">username</span><span style="color:#89DDFF;">:</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">xingongshuo@7jtghd.onmicrosoft.com</span><span style="color:#EEFFFF;"> </span><span style="color:#545454;font-style:italic;">#邮箱账号</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#F07178;">password</span><span style="color:#89DDFF;">:</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">password</span><span style="color:#EEFFFF;"> </span><span style="color:#545454;font-style:italic;">#邮箱密码</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#545454;font-style:italic;"># 端口号465或587 不同邮箱服务商去官网查阅</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#F07178;">port</span><span style="color:#89DDFF;">:</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">587</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#545454;font-style:italic;"># 默认的邮件编码为UTF-8</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#F07178;">default-encoding</span><span style="color:#89DDFF;">:</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">UTF-8</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#F07178;">properties</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#EEFFFF;">      </span><span style="color:#F07178;">from</span><span style="color:#89DDFF;">:</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">xingongshuo@7jtghd.onmicrosoft.com</span></span>
<span class="line"><span style="color:#89DDFF;">     </span><span style="color:#545454;font-style:italic;">#发件人地址，一般与邮箱账号一致</span></span></code></pre><pre class="shiki light-plus vp-code-light"><code><span class="line"><span style="color:#800000;">mail</span><span style="color:#000000;">:</span></span>
<span class="line"><span style="color:#000000;">    </span><span style="color:#008000;"># 配置 SMTP 服务器地址</span></span>
<span class="line"><span style="color:#000000;">    </span><span style="color:#800000;">host</span><span style="color:#000000;">: </span><span style="color:#0000FF;">smtp.office365.com</span></span>
<span class="line"><span style="color:#000000;">    </span><span style="color:#008000;"># 发送者邮箱</span></span>
<span class="line"><span style="color:#000000;">    </span><span style="color:#800000;">username</span><span style="color:#000000;">: </span><span style="color:#0000FF;">xingongshuo@7jtghd.onmicrosoft.com</span><span style="color:#000000;"> </span><span style="color:#008000;">#邮箱账号</span></span>
<span class="line"><span style="color:#000000;">    </span><span style="color:#800000;">password</span><span style="color:#000000;">: </span><span style="color:#0000FF;">password</span><span style="color:#000000;"> </span><span style="color:#008000;">#邮箱密码</span></span>
<span class="line"><span style="color:#000000;">    </span><span style="color:#008000;"># 端口号465或587 不同邮箱服务商去官网查阅</span></span>
<span class="line"><span style="color:#000000;">    </span><span style="color:#800000;">port</span><span style="color:#000000;">: </span><span style="color:#098658;">587</span></span>
<span class="line"><span style="color:#000000;">    </span><span style="color:#008000;"># 默认的邮件编码为UTF-8</span></span>
<span class="line"><span style="color:#000000;">    </span><span style="color:#800000;">default-encoding</span><span style="color:#000000;">: </span><span style="color:#0000FF;">UTF-8</span></span>
<span class="line"><span style="color:#000000;">    </span><span style="color:#800000;">properties</span><span style="color:#000000;">:</span></span>
<span class="line"><span style="color:#000000;">      </span><span style="color:#800000;">from</span><span style="color:#000000;">: </span><span style="color:#0000FF;">xingongshuo@7jtghd.onmicrosoft.com</span></span>
<span class="line"><span style="color:#000000;">     </span><span style="color:#008000;">#发件人地址，一般与邮箱账号一致</span></span></code></pre></div><h2 id="_3-使用" tabindex="-1">3.使用 <a class="header-anchor" href="#_3-使用" aria-label="Permalink to &quot;3.使用&quot;">​</a></h2><p>完成配置后即可在需要使用到的Service中直接使用，当然为了代码简洁性建议封装一个邮件服务。</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki material-theme-darker vp-code-dark"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#EEFFFF;"> </span><span style="color:#C792EA;">String</span><span style="color:#EEFFFF;"> </span><span style="color:#82AAFF;">sendValidateEmail</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#EEFFFF;"> email</span><span style="color:#89DDFF;">,</span><span style="color:#EEFFFF;"> </span><span style="color:#C792EA;">String</span><span style="color:#EEFFFF;"> sessionId</span><span style="color:#89DDFF;">)</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#C792EA;">String</span><span style="color:#EEFFFF;"> key </span><span style="color:#89DDFF;">=</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">email:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">+</span><span style="color:#EEFFFF;"> sessionId </span><span style="color:#89DDFF;">+</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">+</span><span style="color:#EEFFFF;"> email</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;">Boolean</span><span style="color:#89DDFF;">.</span><span style="color:#EEFFFF;">TRUE</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equals</span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;">template</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">hasKey</span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;">key</span><span style="color:#89DDFF;">)))</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#545454;font-style:italic;">//if判断条件为myredis数据库中是否已存在 可忽略</span></span>
<span class="line"><span style="color:#EEFFFF;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">验证码发送频繁,请稍后重试</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;">userMapper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">findUserByNameOrMail</span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;">email</span><span style="color:#89DDFF;">)</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">null)</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#EEFFFF;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">邮箱已被注册</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">    	</span><span style="color:#545454;font-style:italic;">//从数据库中查询用户名或邮箱是否被占用</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#C792EA;">Random</span><span style="color:#EEFFFF;"> random </span><span style="color:#89DDFF;">=</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#EEFFFF;"> </span><span style="color:#82AAFF;">Random</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#C792EA;">int</span><span style="color:#EEFFFF;"> code </span><span style="color:#89DDFF;">=</span><span style="color:#EEFFFF;"> random</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">nextInt</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">899999</span><span style="color:#89DDFF;">)</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">+</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">100000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    	</span><span style="color:#545454;font-style:italic;">//随机函数生成六位验证码</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#C792EA;">MimeMessage</span><span style="color:#EEFFFF;"> message </span><span style="color:#89DDFF;">=</span><span style="color:#EEFFFF;"> mailSender</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createMimeMessage</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#C792EA;">MimeMessageHelper</span><span style="color:#EEFFFF;"> helper</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#C792EA;">Properties</span><span style="color:#EEFFFF;"> properties </span><span style="color:#89DDFF;">=</span><span style="color:#EEFFFF;"> mailSender</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getJavaMailProperties</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#89DDFF;">    	</span><span style="color:#545454;font-style:italic;">//创建邮件类</span></span>
<span class="line"><span style="color:#EEFFFF;">        properties</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">put</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mail.smtp.starttls.enable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">    	</span><span style="color:#545454;font-style:italic;">//微软邮箱要求使用starttls保证安全性</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#EEFFFF;">            helper </span><span style="color:#89DDFF;">=</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#EEFFFF;"> </span><span style="color:#82AAFF;">MimeMessageHelper</span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;">message</span><span style="color:#89DDFF;">,</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">true);</span></span>
<span class="line"><span style="color:#EEFFFF;">            helper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setFrom</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xingongshuo@7jtghd.onmicrosoft.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">AIIT|智能之翼实验室</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#545454;font-style:italic;">//设置发件人地址和发件人名称</span></span>
<span class="line"><span style="color:#EEFFFF;">            helper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setTo</span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;">email</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#EEFFFF;">            helper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setSubject</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">[AIIT|智能之翼实验室]您的验证码</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#545454;font-style:italic;">//设置邮件标题</span></span>
<span class="line"><span style="color:#EEFFFF;">            helper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setText</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">欢迎来到智能之翼实验室，您的注册验证码是：</span><span style="color:#89DDFF;">&quot;</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">+</span><span style="color:#EEFFFF;"> code</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#545454;font-style:italic;">//设置邮件正文</span></span>
<span class="line"><span style="color:#EEFFFF;">            mailSender</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;">message</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#545454;font-style:italic;">//发送邮件</span></span>
<span class="line"><span style="color:#EEFFFF;">            template</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">opsForValue</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">set</span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;">key</span><span style="color:#89DDFF;">,</span><span style="color:#EEFFFF;"> Integer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;">code</span><span style="color:#89DDFF;">),</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#EEFFFF;"> TimeUnit</span><span style="color:#89DDFF;">.</span><span style="color:#EEFFFF;">MINUTES</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#545454;font-style:italic;">//向redis数据库中插入刚才发送的验证码，存活时间为3分钟</span></span>
<span class="line"><span style="color:#EEFFFF;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">}</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">MessagingException</span><span style="color:#EEFFFF;"> </span><span style="color:#EEFFFF;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#EEFFFF;">            e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">printStackTrace</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#EEFFFF;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#EEFFFF;"> e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getMessage</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">}</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">UnsupportedEncodingException</span><span style="color:#EEFFFF;"> </span><span style="color:#EEFFFF;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#EEFFFF;">            </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#EEFFFF;"> </span><span style="color:#82AAFF;">RuntimeException</span><span style="color:#89DDFF;">(</span><span style="color:#EEFFFF;">e</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">}</span></span></code></pre><pre class="shiki light-plus vp-code-light"><code><span class="line"><span style="color:#0000FF;">public</span><span style="color:#000000;"> </span><span style="color:#267F99;">String</span><span style="color:#000000;"> </span><span style="color:#795E26;">sendValidateEmail</span><span style="color:#000000;">(</span><span style="color:#267F99;">String</span><span style="color:#000000;"> email, </span><span style="color:#267F99;">String</span><span style="color:#000000;"> sessionId) {</span></span>
<span class="line"><span style="color:#000000;">        </span><span style="color:#267F99;">String</span><span style="color:#000000;"> </span><span style="color:#001080;">key</span><span style="color:#000000;"> = </span><span style="color:#A31515;">&quot;email:&quot;</span><span style="color:#000000;"> + sessionId + </span><span style="color:#A31515;">&quot;:&quot;</span><span style="color:#000000;"> + email;</span></span>
<span class="line"><span style="color:#000000;">        </span><span style="color:#AF00DB;">if</span><span style="color:#000000;"> (</span><span style="color:#001080;">Boolean</span><span style="color:#000000;">.</span><span style="color:#001080;">TRUE</span><span style="color:#000000;">.</span><span style="color:#795E26;">equals</span><span style="color:#000000;">(</span><span style="color:#001080;">template</span><span style="color:#000000;">.</span><span style="color:#795E26;">hasKey</span><span style="color:#000000;">(key))) {</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#008000;">//if判断条件为myredis数据库中是否已存在 可忽略</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#AF00DB;">return</span><span style="color:#000000;"> </span><span style="color:#A31515;">&quot;验证码发送频繁,请稍后重试&quot;</span><span style="color:#000000;">;</span></span>
<span class="line"><span style="color:#000000;">        }</span></span>
<span class="line"><span style="color:#000000;">        </span><span style="color:#AF00DB;">if</span><span style="color:#000000;"> (</span><span style="color:#001080;">userMapper</span><span style="color:#000000;">.</span><span style="color:#795E26;">findUserByNameOrMail</span><span style="color:#000000;">(email) != </span><span style="color:#0000FF;">null</span><span style="color:#000000;">) {</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#AF00DB;">return</span><span style="color:#000000;"> </span><span style="color:#A31515;">&quot;邮箱已被注册&quot;</span><span style="color:#000000;">;</span></span>
<span class="line"><span style="color:#000000;">        }</span></span>
<span class="line"><span style="color:#000000;">    	</span><span style="color:#008000;">//从数据库中查询用户名或邮箱是否被占用</span></span>
<span class="line"><span style="color:#000000;">        </span><span style="color:#267F99;">Random</span><span style="color:#000000;"> </span><span style="color:#001080;">random</span><span style="color:#000000;"> = </span><span style="color:#AF00DB;">new</span><span style="color:#000000;"> </span><span style="color:#795E26;">Random</span><span style="color:#000000;">();</span></span>
<span class="line"><span style="color:#000000;">        </span><span style="color:#267F99;">int</span><span style="color:#000000;"> </span><span style="color:#001080;">code</span><span style="color:#000000;"> = </span><span style="color:#001080;">random</span><span style="color:#000000;">.</span><span style="color:#795E26;">nextInt</span><span style="color:#000000;">(</span><span style="color:#098658;">899999</span><span style="color:#000000;">) + </span><span style="color:#098658;">100000</span><span style="color:#000000;">;</span></span>
<span class="line"><span style="color:#000000;">    	</span><span style="color:#008000;">//随机函数生成六位验证码</span></span>
<span class="line"><span style="color:#000000;">        </span><span style="color:#267F99;">MimeMessage</span><span style="color:#000000;"> </span><span style="color:#001080;">message</span><span style="color:#000000;"> = </span><span style="color:#001080;">mailSender</span><span style="color:#000000;">.</span><span style="color:#795E26;">createMimeMessage</span><span style="color:#000000;">();</span></span>
<span class="line"><span style="color:#000000;">        </span><span style="color:#267F99;">MimeMessageHelper</span><span style="color:#000000;"> </span><span style="color:#001080;">helper</span><span style="color:#000000;">;</span></span>
<span class="line"><span style="color:#000000;">        </span><span style="color:#267F99;">Properties</span><span style="color:#000000;"> </span><span style="color:#001080;">properties</span><span style="color:#000000;"> = </span><span style="color:#001080;">mailSender</span><span style="color:#000000;">.</span><span style="color:#795E26;">getJavaMailProperties</span><span style="color:#000000;">();</span></span>
<span class="line"><span style="color:#000000;">    	</span><span style="color:#008000;">//创建邮件类</span></span>
<span class="line"><span style="color:#000000;">        </span><span style="color:#001080;">properties</span><span style="color:#000000;">.</span><span style="color:#795E26;">put</span><span style="color:#000000;">(</span><span style="color:#A31515;">&quot;mail.smtp.starttls.enable&quot;</span><span style="color:#000000;">, </span><span style="color:#A31515;">&quot;true&quot;</span><span style="color:#000000;">);</span></span>
<span class="line"><span style="color:#000000;">    	</span><span style="color:#008000;">//微软邮箱要求使用starttls保证安全性</span></span>
<span class="line"><span style="color:#000000;">        </span><span style="color:#AF00DB;">try</span><span style="color:#000000;"> {</span></span>
<span class="line"><span style="color:#000000;">            helper = </span><span style="color:#AF00DB;">new</span><span style="color:#000000;"> </span><span style="color:#795E26;">MimeMessageHelper</span><span style="color:#000000;">(message, </span><span style="color:#0000FF;">true</span><span style="color:#000000;">);</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#001080;">helper</span><span style="color:#000000;">.</span><span style="color:#795E26;">setFrom</span><span style="color:#000000;">(</span><span style="color:#A31515;">&quot;xingongshuo@7jtghd.onmicrosoft.com&quot;</span><span style="color:#000000;">, </span><span style="color:#A31515;">&quot;AIIT|智能之翼实验室&quot;</span><span style="color:#000000;">);</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#008000;">//设置发件人地址和发件人名称</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#001080;">helper</span><span style="color:#000000;">.</span><span style="color:#795E26;">setTo</span><span style="color:#000000;">(email);</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#001080;">helper</span><span style="color:#000000;">.</span><span style="color:#795E26;">setSubject</span><span style="color:#000000;">(</span><span style="color:#A31515;">&quot;[AIIT|智能之翼实验室]您的验证码&quot;</span><span style="color:#000000;">);</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#008000;">//设置邮件标题</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#001080;">helper</span><span style="color:#000000;">.</span><span style="color:#795E26;">setText</span><span style="color:#000000;">(</span><span style="color:#A31515;">&quot;欢迎来到智能之翼实验室，您的注册验证码是：&quot;</span><span style="color:#000000;"> + code);</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#008000;">//设置邮件正文</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#001080;">mailSender</span><span style="color:#000000;">.</span><span style="color:#795E26;">send</span><span style="color:#000000;">(message);</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#008000;">//发送邮件</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#001080;">template</span><span style="color:#000000;">.</span><span style="color:#795E26;">opsForValue</span><span style="color:#000000;">().</span><span style="color:#795E26;">set</span><span style="color:#000000;">(key, </span><span style="color:#001080;">Integer</span><span style="color:#000000;">.</span><span style="color:#795E26;">toString</span><span style="color:#000000;">(code), </span><span style="color:#098658;">3</span><span style="color:#000000;">, </span><span style="color:#001080;">TimeUnit</span><span style="color:#000000;">.</span><span style="color:#001080;">MINUTES</span><span style="color:#000000;">);</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#008000;">//向redis数据库中插入刚才发送的验证码，存活时间为3分钟</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#AF00DB;">return</span><span style="color:#000000;"> </span><span style="color:#0000FF;">null</span><span style="color:#000000;">;</span></span>
<span class="line"><span style="color:#000000;">        } </span><span style="color:#AF00DB;">catch</span><span style="color:#000000;"> (</span><span style="color:#267F99;">MessagingException</span><span style="color:#000000;"> </span><span style="color:#001080;">e</span><span style="color:#000000;">) {</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#001080;">e</span><span style="color:#000000;">.</span><span style="color:#795E26;">printStackTrace</span><span style="color:#000000;">();</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#AF00DB;">return</span><span style="color:#000000;"> </span><span style="color:#001080;">e</span><span style="color:#000000;">.</span><span style="color:#795E26;">getMessage</span><span style="color:#000000;">();</span></span>
<span class="line"><span style="color:#000000;">        } </span><span style="color:#AF00DB;">catch</span><span style="color:#000000;"> (</span><span style="color:#267F99;">UnsupportedEncodingException</span><span style="color:#000000;"> </span><span style="color:#001080;">e</span><span style="color:#000000;">) {</span></span>
<span class="line"><span style="color:#000000;">            </span><span style="color:#AF00DB;">throw</span><span style="color:#000000;"> </span><span style="color:#AF00DB;">new</span><span style="color:#000000;"> </span><span style="color:#795E26;">RuntimeException</span><span style="color:#000000;">(e);</span></span>
<span class="line"><span style="color:#000000;">        }</span></span>
<span class="line"><span style="color:#000000;">    }</span></span></code></pre></div><p>以上便是Springboot集成邮件发送的简易流程。</p>`,12),e=[o];function t(c,F,r,y,i,D){return n(),a("div",null,e)}const m=s(p,[["render",t]]);export{d as __pageData,m as default};
